<!-- Join Modal -->
@if (showJoinModal()) {
<app-join-modal
  [roomId]="route.snapshot.paramMap.get('roomId')!"
  [isLoading]="isLoading()"
  (cancelled)="onCancelJoin()"
  (joined)="onJoinRoom($event)"
/>
}

<!-- Connecting Overlay -->
@if (isLoading() && !showJoinModal()) {
<div
  class="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 animate-fadeIn"
>
  <div
    class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-2xl p-8 max-w-sm w-full mx-4 text-center"
  >
    <div
      class="w-12 h-12 mx-auto mb-4 border-4 border-violet-200 dark:border-violet-900 border-t-violet-500 rounded-full animate-spin"
    ></div>
    <h2 class="text-lg font-semibold text-slate-800 dark:text-white mb-1">Connecting to Room</h2>
    <p class="text-slate-500 dark:text-slate-400 text-sm">Please wait...</p>
  </div>
</div>
}

<!-- Room Content -->
@if (room.isConnected()) {
<div class="w-full max-w-6xl animate-fadeIn">
  <!-- Header -->
  <app-room-header
    [roomId]="room.roomId()!"
    [playerCount]="room.players().length"
    [showCopied]="showCopiedToast()"
    (leaveRoom)="onLeaveRoom()"
    (copyRoomCode)="onCopyRoomCode()"
  />

  <!-- Players Area -->
  <app-players-area
    [players]="room.players()"
    [currentPlayerId]="room.currentPlayer()?.id ?? null"
    [isRevealed]="room.isRevealed()"
    (editName)="showEditNameModal.set(true)"
  />

  <!-- Voting Cards -->
  <app-voting-cards
    [selectedCard]="room.currentPlayer()?.vote ?? null"
    [disabled]="room.isRevealed()"
    [consensusState]="consensusState()"
    (cardSelected)="onVote($event)"
  />

  <!-- Action Buttons -->
  <app-room-actions
    [isHost]="room.isHost()"
    [isRevealed]="room.isRevealed()"
    [allVoted]="room.allVoted()"
    (reveal)="onReveal()"
    (reset)="onReset()"
  />
</div>
}

<!-- Room Not Found Modal -->
@if (showConnectionError()) {
<app-not-found-modal (retry)="onRetry()" (returnToLobby)="onReturnToLobby()" />
}

<!-- Edit Name Modal -->
@if (showEditNameModal() && room.currentPlayer()) {
<app-edit-name-modal
  [currentName]="room.currentPlayer()!.name"
  (saved)="onNameSaved($event)"
  (cancelled)="showEditNameModal.set(false)"
/>
}
